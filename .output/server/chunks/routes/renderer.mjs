import{getRequestDependencies as t,getPreloadLinks as e,getPrefetchLinks as r}from"vue-bundle-renderer/runtime";import{g as o,a as s,b as a,d as n,c as i,p as d,e as p,f as l,h as u,i as m,j as h,k as c,s as y,l as f,m as g,n as b,r as _,o as k,u as x}from"../nitro/nitro.mjs";import{stringify as C,uneval as w}from"devalue";import{propsToString as A,renderSSRHead as j}from"unhead/server";import"unist-util-visit";import"hast-util-to-string";import"node:http";import"node:https";import"node:events";import"node:buffer";import"node:fs";import"node:path";import"node:crypto";import"vue";import"consola";import"@unhead/schema-org/vue";import"node:url";import"unified";import"mdast-util-to-string";import"micromark";import"unist-util-stringify-position";import"micromark-util-character";import"micromark-util-chunked";import"micromark-util-resolve-all";import"micromark-util-sanitize-uri";import"slugify";import"remark-parse";import"remark-rehype";import"remark-mdc";import"remark-gfm";import"rehype-external-links";import"rehype-sort-attribute-values";import"rehype-sort-attributes";import"rehype-raw";import"detab";import"github-slugger";import"unhead/utils";import"unhead/plugins";import"vue/server-renderer";import"ipx";function renderPayloadJsonScript(t){const e={type:"application/json",innerHTML:t.data?C(t.data,t.ssrContext._payloadReducers):"","data-nuxt-data":a,"data-ssr":!t.ssrContext.noSSR,id:"__NUXT_DATA__"};t.src&&(e["data-src"]=t.src);return[e,{innerHTML:`window.__NUXT__={};window.__NUXT__.config=${w(t.ssrContext.config)}`}]}function splitPayload(t){const{data:e,prerenderedAt:r,...o}=t.payload;return{initial:{...o,prerenderedAt:r},payload:{data:e,prerenderedAt:r}}}const v={omitLineBreaks:!1};globalThis.__buildAssetsURL=i,globalThis.__publicAssetsURL=d;const T=!!l.id,R=T?`<${p}${A(l)}>`:"",$=T?`</${p}>`:"",P=/^[^?]*\/_payload.json(?:\?.*)?$/,S=n(async a=>{const n=x(),d=a.path.startsWith("/__nuxt_error")?u(a):null;if(d&&!("__unenv__"in a.node.req))throw m({statusCode:404,statusMessage:"Page Not Found: /__nuxt_error"});const p=h(a),w={mode:"server"};p.head.push(c,w),d&&(d.statusCode&&=Number.parseInt(d.statusCode),y(p,d));const A=P.test(p.url);if(A){const t=p.url.substring(0,p.url.lastIndexOf("/"))||"/";p.url=t,a._path=a.node.req.url=t}const S=f(a);!1===S.ssr&&(p.noSSR=!0);const L=await g(p);for(const t of await b())p.modules.add(t);const N=await L.renderToString(p).catch(async t=>{if(p._renderResponse&&"skipping render"===t.message)return{};const e=!d&&p.payload?.error||t;throw await(p.nuxt?.hooks.callHook("app:error",e)),e}),U=p._renderResponse||A?[]:await _(p.modules??[]);if(await(p.nuxt?.hooks.callHook("app:rendered",{ssrContext:p,renderResult:N})),p._renderResponse)return p._renderResponse;if(p.payload?.error&&!d)throw p.payload.error;if(A){const t=function(t){return{body:C(splitPayload(t).payload,t._payloadReducers),statusCode:s(t.event),statusMessage:o(t.event),headers:{"content-type":"application/json;charset=utf-8","x-powered-by":"Nuxt"}}}(p);return t}const M=S.noScripts,{styles:H,scripts:O}=t(p,L.rendererContext);p._preloadManifest&&!M&&p.head.push({link:[{rel:"preload",as:"fetch",fetchpriority:"low",crossorigin:"anonymous",href:i(`builds/meta/${p.runtimeConfig.app.buildId}.json`)}]},{...w,tagPriority:"low"}),U.length&&p.head.push({style:U});const z=[];for(const t of Object.values(H))z.push({rel:"stylesheet",href:L.rendererContext.buildAssetsURL(t.file),crossorigin:""});if(z.length&&p.head.push({link:z},w),M||(p.head.push({link:e(p,L.rendererContext)},w),p.head.push({link:r(p,L.rendererContext)},w),p.head.push({script:renderPayloadJsonScript({ssrContext:p,data:p.payload})},{...w,tagPosition:"bodyClose",tagPriority:"high"})),!S.noScripts){const t="head";p.head.push({script:Object.values(O).map(e=>({type:e.module?"module":null,src:L.rendererContext.buildAssetsURL(e.file),defer:!e.module||null,tagPosition:t,crossorigin:""}))},w)}const{headTags:I,bodyTags:X,bodyTagsOpen:q,htmlAttrs:B,bodyAttrs:D}=await j(p.head,v),J={htmlAttrs:B?[B]:[],head:normalizeChunks([I]),bodyAttrs:D?[D]:[],bodyPrepend:normalizeChunks([q,p.teleports?.body]),body:[k(p,N.html),R+(T?joinTags([p.teleports?.[`#${l.id}`]]):"")+$],bodyAppend:[X]};return await n.hooks.callHook("render:html",J,{event:a}),{body:(E=J,`<!DOCTYPE html><html${joinAttrs(E.htmlAttrs)}><head>${joinTags(E.head)}</head><body${joinAttrs(E.bodyAttrs)}>${joinTags(E.bodyPrepend)}${joinTags(E.body)}${joinTags(E.bodyAppend)}</body></html>`),statusCode:s(a),statusMessage:o(a),headers:{"content-type":"text/html;charset=utf-8","x-powered-by":"Nuxt"}};var E});function normalizeChunks(t){return t.filter(Boolean).map(t=>t.trim())}function joinTags(t){return t.join("")}function joinAttrs(t){return 0===t.length?"":" "+t.join(" ")}export{S as default};
//# sourceMappingURL=renderer.mjs.map
