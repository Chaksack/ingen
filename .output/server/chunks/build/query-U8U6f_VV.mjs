import{computed as e,toValue as a,getCurrentInstance as t,onServerPrefetch as r,ref as n,shallowRef as s,toRef as o,nextTick as i,unref as u}from"vue";import{debounce as l}from"perfect-debounce";import{e as c,f as d,c as p,b as y,g as f}from"./server.mjs";import{O as v,M as h,y as m,N as g,Q as _}from"../nitro/nitro.mjs";import{u as w}from"./preview-CyjoVtle.mjs";function useAsyncData(...y){var f;const v="string"==typeof y[y.length-1]?y.pop():void 0;(function(e,a){if("string"==typeof e)return!1;if("object"==typeof e&&null!==e)return!1;if("function"==typeof e&&"function"==typeof a)return!1;return!0})(y[0],y[1])&&y.unshift(v);let[h,m,g={}]=y;const _=e(()=>a(h));if("string"!=typeof _.value)throw new TypeError("[nuxt] [useAsyncData] key must be a string.");if("function"!=typeof m)throw new TypeError("[nuxt] [useAsyncData] handler must be a function.");const w=c();null!=g.server||(g.server=!0),null!=g.default||(g.default=getDefault),null!=g.getCachedData||(g.getCachedData=getDefaultCachedData),null!=g.lazy||(g.lazy=!1),null!=g.immediate||(g.immediate=!0),null!=g.deep||(g.deep=d.deep),null!=g.dedupe||(g.dedupe="cancel"),g._functionName,w._asyncData[_.value];const D={cause:"initial",dedupe:g.dedupe};(null==(f=w._asyncData[_.value])?void 0:f._init)||(D.cachedData=g.getCachedData(_.value,w,{cause:"initial"}),w._asyncData[_.value]=function(e,a,t,r,c){var y;null!=(y=e.payload._errors)[a]||(y[a]=d.errorValue);const f=r.getCachedData!==getDefaultCachedData,v=t,h=r.deep?n:s,m=null!=c,g=e.hook("app:data:refresh",async e=>{e&&!e.includes(a)||await _.execute({cause:"refresh:hook"})}),_={data:h(m?c:r.default()),pending:s(!m),error:o(e.payload._errors,a),status:s("idle"),execute:(...t)=>{var n,s;const[o,i]=t,l=o&&void 0===i&&"object"==typeof o?o:{};if(e._asyncDataPromises[a]){if("defer"===(c=null!=(n=l.dedupe)?n:r.dedupe)||!1===c)return e._asyncDataPromises[a];e._asyncDataPromises[a].cancelled=!0}var c;if("initial"===l.cause||e.isHydrating){const t="cachedData"in l?l.cachedData:r.getCachedData(a,e,{cause:null!=(s=l.cause)?s:"refresh:manual"});if(null!=t)return e.payload.data[a]=_.data.value=t,_.error.value=d.errorValue,_.status.value="success",Promise.resolve(t)}_.pending.value=!0,_.status.value="pending";const y=new Promise((a,t)=>{try{a(v(e))}catch(e){t(e)}}).then(async t=>{if(y.cancelled)return e._asyncDataPromises[a];let n=t;r.transform&&(n=await r.transform(t)),r.pick&&(n=function(e,a){const t={};for(const r of a)t[r]=e[r];return t}(n,r.pick)),e.payload.data[a]=n,_.data.value=n,_.error.value=d.errorValue,_.status.value="success"}).catch(t=>{if(y.cancelled)return e._asyncDataPromises[a];_.error.value=p(t),_.data.value=u(r.default()),_.status.value="error"}).finally(()=>{y.cancelled||(_.pending.value=!1,delete e._asyncDataPromises[a])});return e._asyncDataPromises[a]=y,e._asyncDataPromises[a]},_execute:l((...e)=>_.execute(...e),0,{leading:!0}),_default:r.default,_deps:0,_init:!0,_hash:void 0,_off:()=>{var t;g(),(null==(t=e._asyncData[a])?void 0:t._init)&&(e._asyncData[a]._init=!1),f||i(()=>{var t;(null==(t=e._asyncData[a])?void 0:t._init)||(clearNuxtDataByKey(e,a),_.execute=()=>Promise.resolve(),_.data.value=d.value)})}};return _}(w,_.value,m,g,D.cachedData));w._asyncData[_.value]._deps++;if(!1!==g.server&&w.payload.serverRendered&&g.immediate){const e=w._asyncData[_.value].execute(D);t()?r(()=>e):w.hook("app:created",async()=>{await e})}const b={data:writableComputedRef(()=>{var e;return null==(e=w._asyncData[_.value])?void 0:e.data}),pending:writableComputedRef(()=>{var e;return null==(e=w._asyncData[_.value])?void 0:e.pending}),status:writableComputedRef(()=>{var e;return null==(e=w._asyncData[_.value])?void 0:e.status}),error:writableComputedRef(()=>{var e;return null==(e=w._asyncData[_.value])?void 0:e.error}),refresh:(...e)=>w._asyncData[_.value].execute(...e),execute:(...e)=>w._asyncData[_.value].execute(...e),clear:()=>clearNuxtDataByKey(w,_.value)},x=Promise.resolve(w._asyncDataPromises[_.value]).then(()=>b);return Object.assign(x,b),x}function writableComputedRef(a){return e({get(){var e;return null==(e=a())?void 0:e.value},set(e){const t=a();t&&(t.value=e)}})}function clearNuxtDataByKey(e,a){a in e.payload.data&&(e.payload.data[a]=void 0),a in e.payload._errors&&(e.payload._errors[a]=d.errorValue),e._asyncData[a]&&(e._asyncData[a].data.value=void 0,e._asyncData[a].error.value=d.errorValue,e._asyncData[a].pending.value=!1,e._asyncData[a].status.value="idle"),a in e._asyncDataPromises&&(e._asyncDataPromises[a]&&(e._asyncDataPromises[a].cancelled=!0),e._asyncDataPromises[a]=void 0)}const getDefault=()=>d.value,getDefaultCachedData=(e,a,t)=>a.isHydrating?a.payload.data[e]:"refresh:manual"!==t.cause&&"refresh:hook"!==t.cause?a.static.data[e]:void 0,get=(e,a)=>a.split(".").reduce((e,a)=>e&&e[a],e),_pick=(e,a)=>Object.keys(e).filter(a).reduce((a,t)=>Object.assign(a,{[t]:e[t]}),{}),omit=e=>a=>e&&e.length?_pick(a,a=>!e.includes(a)):a,apply=e=>a=>Array.isArray(a)?a.map(a=>e(a)):e(a),detectProperties=e=>{const a=[],t=[];for(const r of e)["$","_"].includes(r)?a.push(r):t.push(r);return{prefixes:a,properties:t}},withoutKeys=(e=[])=>a=>{if(0===e.length||!a)return a;const{prefixes:t,properties:r}=detectProperties(e);return _pick(a,e=>!r.includes(e)&&!t.includes(e[0]))},withKeys=(e=[])=>a=>{if(0===e.length||!a)return a;const{prefixes:t,properties:r}=detectProperties(e);return _pick(a,e=>r.includes(e)||t.includes(e[0]))},sortList=(e,a)=>{const t=new Intl.Collator(a.$locale,{numeric:a.$numeric,caseFirst:a.$caseFirst,sensitivity:a.$sensitivity}),r=Object.keys(a).filter(e=>!e.startsWith("$"));for(const n of r)e=e.sort((e,r)=>{const s=[get(e,n),get(r,n)].map(e=>{if(null!==e)return e instanceof Date?e.toISOString():e});return-1===a[n]&&s.reverse(),t.compare(s[0],s[1])});return e},assertArray=(e,a="Expected an array")=>{if(!Array.isArray(e))throw new TypeError(a)},ensureArray=e=>Array.isArray(e)?e:[void 0,null].includes(e)?[]:[e],D=["sort","where","only","without"];function createQuery(e,a={}){const t={};for(const e of Object.keys(a.initialParams||{}))t[e]=D.includes(e)?ensureArray(a.initialParams[e]):a.initialParams[e];const $set=(e,a=e=>e)=>(...n)=>(t[e]=a(...n),r),resolveResult=e=>{var t;return a.legacy?(null==e?void 0:e.surround)?e.surround:e?((null==e?void 0:e.dirConfig)&&(e.result={_path:null==(t=e.dirConfig)?void 0:t._path,...e.result,_dir:e.dirConfig}),(null==e?void 0:e._path)||Array.isArray(e)||!Object.prototype.hasOwnProperty.call(e,"result")?e:null==e?void 0:e.result):e:e},r={params:()=>({...t,...t.where?{where:[...ensureArray(t.where)]}:{},...t.sort?{sort:[...ensureArray(t.sort)]}:{}}),only:$set("only",ensureArray),without:$set("without",ensureArray),where:$set("where",e=>[...ensureArray(t.where),...ensureArray(e)]),sort:$set("sort",e=>[...ensureArray(t.sort),...ensureArray(e)]),limit:$set("limit",e=>parseInt(String(e),10)),skip:$set("skip",e=>parseInt(String(e),10)),find:()=>e(r).then(resolveResult),findOne:()=>e($set("first")(!0)).then(resolveResult),count:()=>e($set("count")(!0)).then(resolveResult),locale:e=>r.where({_locale:e}),withSurround:$set("surround",(e,a)=>({query:e,...a})),withDirConfig:()=>$set("dirConfig")(!0)};return a.legacy?(r.findSurround=(e,a)=>r.withSurround(e,a).find().then(resolveResult),r):r}function jsonStringify(e){return JSON.stringify(e,regExpReplacer)}function regExpReplacer(e,a){return a instanceof RegExp?`--REGEX ${a.toString()}`:a}const encodeQueryParams=e=>{let a=jsonStringify(e);a="undefined"!=typeof Buffer?Buffer.from(a).toString("base64"):btoa(a),a=a.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"");return(a.match(/.{1,100}/g)||[]).join("/")},withContentBase=e=>v(e,y().public.content.api.baseURL),useContentDisabled=()=>{throw console.warn("useContent is only accessible when you are using `documentDriven` mode."),console.warn("Learn more by visiting: https://content.nuxt.com/document-driven"),new Error("useContent is only accessible when you are using `documentDriven` mode.")},addPrerenderPath=e=>{const a=f();a&&a.node.res.setHeader("x-nitro-prerender",[a.node.res.getHeader("x-nitro-prerender"),e].filter(Boolean).join(","))},shouldUseClientDB=()=>{const{experimental:e}=y().public.content;return!1};function queryContent(e,...a){const{content:t}=y().public,r=createQuery(async e=>{const{content:a}=y().public,t=e.params(),r=a.experimental.stripQueryParameters?withContentBase(`/query/${_(t)}.${a.integrity}/${encodeQueryParams(t)}.json`):withContentBase(`/query/${_(t)}.${a.integrity}.json`);if(addPrerenderPath(r),shouldUseClientDB())return(await import("./client-db-BYIq7tLa.mjs").then(e=>e.useContentDatabase())).fetch(e);const n=await $fetch(r,{method:"GET",responseType:"json",params:a.experimental.stripQueryParameters?void 0:{_params:jsonStringify(t),previewToken:w().getPreviewToken()}});if("string"==typeof n&&n.startsWith("<!DOCTYPE html>"))throw new Error("Not found");return n},{initialParams:"string"!=typeof e?e:{},legacy:!0});let n;"string"==typeof e&&(n=h(m(e,...a)));const s=r.params;return r.params=()=>{var e,a,r;const o=s();if(n&&(o.where=o.where||[],o.first&&0===(o.where||[]).length?o.where.push({_path:g(n)}):o.where.push({_path:new RegExp(`^${n.replace(/[-[\]{}()*+.,^$\s/]/g,"\\$&")}`)})),(null==(e=o.sort)?void 0:e.length)||(o.sort=[{_stem:1,$numeric:!0}]),t.locales.length){(null==(r=null==(a=o.where)?void 0:a.find(e=>e._locale))?void 0:r._locale)||(o.where=o.where||[],o.where.push({_locale:t.defaultLocale}))}return o},r}export{useAsyncData as a,addPrerenderPath as b,createQuery as c,ensureArray as d,encodeQueryParams as e,apply as f,get as g,sortList as h,withoutKeys as i,jsonStringify as j,withKeys as k,assertArray as l,omit as o,queryContent as q,shouldUseClientDB as s,useContentDisabled as u,withContentBase as w};
//# sourceMappingURL=query-U8U6f_VV.mjs.map
